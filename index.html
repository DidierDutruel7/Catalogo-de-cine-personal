<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Archivo de Cine</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #fff;
    margin: 40px;
}

h1 {
    font-weight: 400;
}

input[type="text"],
input[type="number"] {
    border: none;
    background: transparent;
    outline: none;
    width: 100%;
    font-size: 14px;
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
}

th {
    text-align: left;
    font-weight: 600;
    padding-bottom: 8px;
    border-bottom: 1px solid #000;
}

td {
    padding: 6px 4px;
    border-bottom: 1px solid #ddd;
    vertical-align: middle;
}

button {
    background: none;
    border: none;
    cursor: pointer;
    font-size: 13px;
}

button:hover {
    text-decoration: underline;
}

#search {
    margin-top: 20px;
    width: 300px;
    border-bottom: 1px solid #000;
    font-size: 14px;
}

.modal {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.8);
    align-items: center;
    justify-content: center;
}

.modal img {
    max-width: 80%;
    max-height: 80%;
}
</style>
</head>

<body>

<h1>Archivo de Cine</h1>

<input id="search" placeholder="Buscar‚Ä¶" oninput="render()">

<table>
<thead>
<tr>
    <th>Director</th>
    <th>Pel√≠cula</th>
    <th>Nacionalidad</th>
    <th>Pa√≠s</th>
    <th>A√±o</th>
    <th>Vista</th>
    <th>Portada</th>
    <th>Eliminar</th>
</tr>
</thead>
<tbody id="rows"></tbody>
</table>

<button onclick="addRow()">+ Agregar pel√≠cula</button>

<div class="modal" id="modal" onclick="this.style.display='none'">
    <img id="modalImg">
</div>

<script>
let data = JSON.parse(localStorage.getItem("films")) || [];

function save() {
    localStorage.setItem("films", JSON.stringify(data));
}

function addRow() {
    data.push({
        director: "",
        title: "",
        nationality: "",
        country: "",
        year: "",
        seen: false,
        cover: ""
    });
    save();
    render();
}

function removeRow(i) {
    if (confirm("¬øEliminar esta pel√≠cula?")) {
        data.splice(i, 1);
        save();
        render();
    }
}

function openCover(src) {
    if (!src) return;
    document.getElementById("modalImg").src = src;
    document.getElementById("modal").style.display = "flex";
}

function uploadCover(e, i) {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = () => {
        data[i].cover = reader.result;
        save();
        render();
    };
    reader.readAsDataURL(file);
}

function render() {
    const tbody = document.getElementById("rows");
    const q = document.getElementById("search").value.toLowerCase();

    // üî• ORDEN CLAVE (DIRECTOR ‚Üí A√ëO)
    data.sort((a, b) => {

        const d = a.director.localeCompare(
            b.director,
            "es",
            { sensitivity: "base" }
        );

        if (d !== 0) return d;

        return (parseInt(a.year) || 0) - (parseInt(b.year) || 0);
    });

    tbody.innerHTML = "";

    data.forEach((f, i) => {
        if (
            !Object.values(f)
                .join(" ")
                .toLowerCase()
                .includes(q)
        ) return;

        const tr = document.createElement("tr");

        tr.innerHTML = `
<td><input value="${f.director}" oninput="data[${i}].director=this.value;save()"></td>
<td><input value="${f.title}" oninput="data[${i}].title=this.value;save()"></td>
<td><input value="${f.nationality}" oninput="data[${i}].nationality=this.value;save()"></td>
<td><input value="${f.country}" oninput="data[${i}].country=this.value;save()"></td>
<td><input type="number" value="${f.year}" oninput="data[${i}].year=this.value;save()"></td>
<td><input type="checkbox" ${f.seen ? "checked" : ""} onchange="data[${i}].seen=this.checked;save()"></td>
<td>
    <button onclick="openCover('${f.cover}')">Ver</button>
    <input type="file" accept="image/*" onchange="uploadCover(event, ${i})">
</td>
<td><button onclick="removeRow(${i})">‚úï</button></td>
        `;
        tbody.appendChild(tr);
    });
}

render();
</script>

</body>
</html>