<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Archivo de Cine</title>

<style>
body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    background: #fff;
    margin: 32px;
    color: #111;
}

h1 {
    font-weight: 400;
    font-size: 22px;
    margin-bottom: 18px;
}

/* BUSCADOR */
#search {
    width: 280px;
    font-size: 14px;
    border: none;
    border-bottom: 1px solid #111;
    outline: none;
    padding: 4px 0;
}

/* TABLA */
table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 18px;
}

th {
    font-size: 12px;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: .04em;
    padding-bottom: 6px;
    border-bottom: 1px solid #111;
}

td {
    padding: 4px 2px;
    border-bottom: 1px solid #e5e5e5;
    vertical-align: middle;
}

/* INPUTS FLOTANTES */
input[type="text"],
input[type="number"] {
    border: none;
    background: transparent;
    outline: none;
    width: 100%;
    font-size: 14px;
    line-height: 1.2;
    padding: 2px 0;
}

/* CHECK */
input[type="checkbox"] {
    transform: scale(.9);
}

/* BOTONES */
button {
    background: none;
    border: none;
    padding: 0;
    font-size: 12px;
    cursor: pointer;
    color: #111;
}

button:hover {
    opacity: .6;
}

/* MODAL */
.modal {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.85);
    align-items: center;
    justify-content: center;
}

.modal img {
    max-width: 80%;
    max-height: 80%;
}

/* FOOT ACTION */
.add {
    margin-top: 14px;
    font-size: 13px;
}
</style>
</head>

<body>

<h1>Archivo de Cine</h1>

<input id="search" placeholder="Buscar…" oninput="render()">

<table>
<thead>
<tr>
    <th>Director</th>
    <th>Película</th>
    <th>Nacionalidad</th>
    <th>País</th>
    <th>Año</th>
    <th>Vista</th>
    <th>Portada</th>
    <th></th>
</tr>
</thead>
<tbody id="rows"></tbody>
</table>

<button class="add" onclick="addRow()">+ Agregar película</button>

<div class="modal" id="modal" onclick="this.style.display='none'">
    <img id="modalImg">
</div>

<script>
let data = JSON.parse(localStorage.getItem("films")) || [];

function save() {
    localStorage.setItem("films", JSON.stringify(data));
}

function addRow() {
    data.push({
        director: "",
        title: "",
        nationality: "",
        country: "",
        year: "",
        seen: false,
        cover: ""
    });
    save();
    render();
}

function removeRow(i) {
    if (confirm("¿Eliminar esta película?")) {
        data.splice(i, 1);
        save();
        render();
    }
}

function openCover(src) {
    if (!src) return;
    document.getElementById("modalImg").src = src;
    document.getElementById("modal").style.display = "flex";
}

function uploadCover(e, i) {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = () => {
        data[i].cover = reader.result;
        save();
        render();
    };
    reader.readAsDataURL(file);
}

function render() {
    const tbody = document.getElementById("rows");
    const q = document.getElementById("search").value.toLowerCase();

    data.sort((a, b) => {
        const d = a.director.localeCompare(b.director, "es", { sensitivity: "base" });
        if (d !== 0) return d;
        return (parseInt(a.year) || 0) - (parseInt(b.year) || 0);
    });

    tbody.innerHTML = "";

    data.forEach((f, i) => {
        if (!Object.values(f).join(" ").toLowerCase().includes(q)) return;

        const tr = document.createElement("tr");

        tr.innerHTML = `
<td><input value="${f.director}" oninput="data[${i}].director=this.value;save()"></td>
<td><input value="${f.title}" oninput="data[${i}].title=this.value;save()"></td>
<td><input value="${f.nationality}" oninput="data[${i}].nationality=this.value;save()"></td>
<td><input value="${f.country}" oninput="data[${i}].country=this.value;save()"></td>
<td><input type="number" value="${f.year}" oninput="data[${i}].year=this.value;save()"></td>
<td><input type="checkbox" ${f.seen ? "checked" : ""} onchange="data[${i}].seen=this.checked;save()"></td>
<td>
    <button onclick="openCover('${f.cover}')">ver</button>
    <input type="file" accept="image/*" onchange="uploadCover(event, ${i})">
</td>
<td><button onclick="removeRow(${i})">×</button></td>
        `;
        tbody.appendChild(tr);
    });
}

render();
</script>

</body>
</html>