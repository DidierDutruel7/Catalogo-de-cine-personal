<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Catálogo de cine</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
    --bg:#fafafa;
    --fg:#111;
    --muted:#777;
    --line:#e5e5e5;
}

body{
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
    background:var(--bg);
    color:var(--fg);
    margin:0;
    padding:36px 18px;
}

header{
    text-align:center;
    margin-bottom:22px;
}

h1{
    font-size:21px;
    font-weight:500;
    margin-bottom:16px;
}

#search{
    width:100%;
    max-width:520px;
    padding:12px 16px;
    font-size:15px;
    border:1px solid var(--line);
    border-radius:22px;
    outline:none;
}

.stats{
    margin-top:12px;
    font-size:12px;
    color:var(--muted);
}

.tools{
    position:fixed;
    top:18px;
    right:18px;
}

.tools button{
    background:none;
    border:1px solid var(--line);
    border-radius:20px;
    padding:7px 13px;
    cursor:pointer;
}

.tools-menu{
    display:none;
    position:absolute;
    right:0;
    margin-top:8px;
    background:white;
    border:1px solid var(--line);
    border-radius:8px;
    box-shadow:0 10px 30px rgba(0,0,0,.08);
}

.tools-menu button{
    width:100%;
    padding:9px 15px;
    border:none;
    background:none;
    text-align:left;
    cursor:pointer;
    font-size:13px;
}

.tools-menu button:hover{background:#f2f2f2}

table{
    width:100%;
    border-collapse:collapse;
    margin-top:26px;
}

th{
    font-size:11px;
    font-weight:500;
    color:var(--muted);
    text-align:left;
    padding:6px 8px;
    border-bottom:1px solid var(--line);
}

td{
    padding:6px 8px;
    border-bottom:1px solid var(--line);
    font-size:14px;
    line-height:1.2;
}

td input[type="text"],
td input[type="number"]{
    width:100%;
    border:none;
    background:none;
    font-size:14px;
    line-height:1.2;
    padding:0;
}

td input:focus{outline:none}

.delete{
    color:#bbb;
    cursor:pointer;
    font-size:16px;
    visibility:hidden;
}

tr:hover .delete{visibility:visible}

.modal{
    display:none;
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.85);
    justify-content:center;
    align-items:center;
}

.modal img{
    max-width:90%;
    max-height:90%;
}

.modal span{
    position:absolute;
    top:20px;
    right:30px;
    font-size:28px;
    color:white;
    cursor:pointer;
}
</style>
</head>

<body>

<div class="tools">
<button onclick="toggleTools()">☰</button>
<div class="tools-menu" id="toolsMenu">
<button onclick="addRow()">Añadir película</button>
<button onclick="exportCSV()">Exportar CSV</button>
<button onclick="importCSV()">Importar CSV</button>
<button onclick="backup()">Guardar copia</button>
<button onclick="restore()">Restaurar copia</button>
</div>
</div>

<header>
<h1>Catálogo personal de cine</h1>
<input id="search" placeholder="Buscar…">
<div class="stats">
Vistas <span id="vistas">0</span> ·
Pendientes <span id="pendientes">0</span> ·
Total <span id="total">0</span>
</div>
</header>

<table>
<thead>
<tr>
<th>Director</th>
<th>Película</th>
<th>País</th>
<th>Año</th>
<th>Portada</th>
<th>Vista</th>
<th></th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>

<div class="modal" id="modal">
<span onclick="closeModal()">×</span>
<img id="modalImg">
</div>

<script>
let data=JSON.parse(localStorage.getItem("peliculas"))||[];

function persist(){localStorage.setItem("peliculas",JSON.stringify(data));}

function toggleTools(){
const m=document.getElementById("toolsMenu");
m.style.display=m.style.display==="block"?"none":"block";
}

function addRow(){
data.push({director:"",pelicula:"",pais:"",año:"",portada:null,vista:false});
persist();render();
}

function delRow(i){
if(confirm("¿Eliminar esta película?")){
data.splice(i,1);
persist();render();
}
}

function render(){
const tb=document.getElementById("tbody");
tb.innerHTML="";
let v=0;

data.forEach((p,i)=>{
if(p.v) v++;
const tr=document.createElement("tr");
tr.innerHTML=`
<td><input value="${p.director}" oninput="data[${i}].director=this.value;persist()"></td>
<td><input value="${p.pelicula}" oninput="data[${i}].pelicula=this.value;persist()"></td>
<td><input value="${p.pais}" oninput="data[${i}].pais=this.value;persist()"></td>
<td><input type="number" value="${p.año}" oninput="data[${i}].año=this.value;persist()"></td>
<td>
<button onclick="imgUp(${i})">Subir</button>
${p.portada?`<button onclick="imgView(${i})">Ver</button>`:""}
</td>
<td><input type="checkbox" ${p.vista?"checked":""} onchange="data[${i}].vista=this.checked;persist();render()"></td>
<td class="delete" onclick="delRow(${i})">×</td>`;
tb.appendChild(tr);
});

document.getElementById("vistas").textContent=v;
document.getElementById("total").textContent=data.length;
document.getElementById("pendientes").textContent=data.length-v;
}

function imgUp(i){
const f=document.createElement("input");
f.type="file";f.accept="image/*";
f.onchange=()=>{
const r=new FileReader();
r.onload=()=>{data[i].portada=r.result;persist();render();}
r.readAsDataURL(f.files[0]);
};
f.click();
}

function imgView(i){
modalImg.src=data[i].portada;
modal.style.display="flex";
}
function closeModal(){modal.style.display="none"}

document.getElementById("search").oninput=function(){
const q=this.value.toLowerCase();
document.querySelectorAll("tbody tr").forEach(r=>{
r.style.display=r.innerText.toLowerCase().includes(q)?"":"none";
});
};

render();
</script>

</body>
</html>