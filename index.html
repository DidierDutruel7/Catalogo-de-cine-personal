<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Catálogo personal de cine</title>
<style>
body {
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background: #fff;
  margin: 40px;
  color: #111;
}

h1 {
  text-align: center;
  font-weight: 500;
}

#search {
  display: block;
  margin: 20px auto;
  width: 420px;
  padding: 10px 14px;
  border-radius: 20px;
  border: 1px solid #ddd;
}

#counter {
  text-align: center;
  font-size: 13px;
  color: #666;
  margin-bottom: 30px;
}

table {
  width: 100%;
  border-collapse: collapse;
  font-size: 14px;
}

th, td {
  padding: 10px 8px;
  border-bottom: 1px solid #eee;
}

th {
  font-weight: 500;
  text-align: left;
  color: #666;
}

button {
  font-size: 12px;
  padding: 4px 8px;
  border: 1px solid #999;
  background: #fff;
  cursor: pointer;
}

button:hover {
  background: #f5f5f5;
}

/* Modal */
#modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.8);
  display: none;
  align-items: center;
  justify-content: center;
}

#modal img {
  max-height: 90vh;
  max-width: 90vw;
}

#modal span {
  position: absolute;
  top: 20px;
  right: 30px;
  font-size: 28px;
  color: #fff;
  cursor: pointer;
}
</style>
</head>
<body>

<h1>Catálogo personal de cine</h1>

<input id="search" placeholder="Buscar… (dir., pel., año)">
<div id="counter"></div>

<table>
<thead>
<tr>
  <th>Director</th>
  <th>Año</th>
  <th>Película</th>
  <th>Nacionalidad</th>
  <th>País</th>
  <th>Vista</th>
  <th>Portada</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>

<div id="modal">
  <span onclick="closeModal()">×</span>
  <img id="modalImg">
</div>

<script>
let movies = JSON.parse(localStorage.getItem("movies")) || [];

function save() {
  localStorage.setItem("movies", JSON.stringify(movies));
}

function sortMovies() {
  movies.sort((a,b) => {
    if (a.director !== b.director) {
      return a.director.localeCompare(b.director);
    }
    return a.year - b.year;
  });
}

function updateCounter() {
  const seen = movies.filter(m => m.seen).length;
  counter.textContent = `Vistas ${seen} · Pendientes ${movies.length - seen} · Total ${movies.length}`;
}

function render() {
  sortMovies();
  tbody.innerHTML = "";
  movies.forEach((m,i) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${m.director}</td>
      <td>${m.year}</td>
      <td>${m.title}</td>
      <td>${m.nationality}</td>
      <td>${m.country}</td>
      <td><input type="checkbox" ${m.seen ? "checked":""} onchange="toggleSeen(${i})"></td>
      <td>
        <input type="file" onchange="uploadCover(event,${i})">
        ${m.cover ? `<button onclick="viewCover(${i})">Ver</button>` : ""}
      </td>
    `;
    tbody.appendChild(tr);
  });
  updateCounter();
}

function toggleSeen(i) {
  movies[i].seen = !movies[i].seen;
  save();
  updateCounter();
}

function uploadCover(e,i) {
  const reader = new FileReader();
  reader.onload = () => {
    movies[i].cover = reader.result;
    save();
    render();
  };
  reader.readAsDataURL(e.target.files[0]);
}

function viewCover(i) {
  modalImg.src = movies[i].cover;
  modal.style.display = "flex";
}

function closeModal() {
  modal.style.display = "none";
}

render();
</script>

</body>
</html>
